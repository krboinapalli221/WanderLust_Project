@Library('Shared') _
pipeline {
    agent { label 'Node' }

    parameters {
        string(name: 'APP_NAME', defaultValue: 'wanderlust', description: 'Name of the Argo CD Application')
        string(name: 'ARGOCD_SERVER', defaultValue: '3.136.85.25:30857', description: 'Argo CD Server URL')
        string(name: 'ARGOCD_USERNAME', defaultValue: 'admin', description: 'Argo CD Username')
        string(name: 'ARGOCD_PASSWORD', defaultValue: 'Wanderlust', description: 'Argo CD Password')
    }

    stages {
        stage("Checkout Code") {
            steps {
                script {
                    // Replace with your GitHub repository URL and branch
                    code_checkout("https://github.com/krboinapalli221/WanderLust_Project.git", "main")
                }
            }
        }

        stage("Trigger Argo CD Sync") {
            steps {
                script {
                    // Login to Argo CD
                    sh """
                    yes | argocd login ${params.ARGOCD_SERVER} --username ${params.ARGOCD_USERNAME} --password ${params.ARGOCD_PASSWORD} --insecure
                    """
                    
                    // Sync the application
                    sh """
                    argocd app sync ${params.APP_NAME}
                    """
                }
            }
        }
    }

    post {
        success {
            echo 'CD Pipeline triggered Argo CD successfully!'
        }
        failure {
            echo 'CD Pipeline failed!'
        }
    }
}
